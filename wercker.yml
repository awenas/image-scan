box: ubuntu

build:
  docker: true
  services:
  - id: arminc/clair-db
    tag: 2017-09-18
    name: postgres
  - id: arminc/clair-local-scan
    tag: v2.0.1
    name: clair
  steps:
  - script:
    name: Install clair-scanner and pre-reqs
    code: |
      apt-get update
      apt-get install -y curl docker.io
      curl -L -O https://github.com/arminc/clair-scanner/releases/download/v8/clair-scanner_linux_amd64
      mv clair-scanner_linux_amd64 clair-scanner
      chmod +x clair-scanner
  - script:
    name: Scan an image
    code: |
      docker pull alpine:3.5
      ./clair-scanner --clair="http://clair:6060" alpine:3.5
